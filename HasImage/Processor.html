<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: HasImage::Processor</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../HasImage.html" title="HasImage (module)">HasImage</a></span></span>
     &raquo; 
    <span class="title">Processor</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: HasImage::Processor
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">HasImage::Processor</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/has_image/processor.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Image processing functionality for the HasImage gem.
</p>


  </div>
</div>
<div class="tags">
  
</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">- (Object) <strong>options</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute options.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#geometry_string_valid%3F-class_method" title="geometry_string_valid? (class method)">+ (Boolean) <strong>geometry_string_valid?</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The form of an <a
href="http://www.imagemagick.org/script/command-line-options.php?#resize">extended
geometry string</a> is:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid%3F-class_method" title="valid? (class method)">+ (Boolean) <strong>valid?</strong>(arg) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Arg should be either a file or a path.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Processor) <strong>initialize</strong>(options) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The constuctor should be invoked with the options set by has_image.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#measure-instance_method" title="#measure (instance method)">- (Object) <strong>measure</strong>(path, dimension) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Gets the given <tt>dimension</tt> (width/height) from the image file at
<tt>path</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (Object) <strong>process</strong>(file, size = options[:resize_to], format = options[:convert_to]) </a>
    

    
      (also: #resize)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Creates the resized image, and transforms it to the desired output format
if necessary.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="HasImage::Processor (class)">Processor</a></span></tt>) <strong>initialize</strong>(options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The constuctor should be invoked with the options set by has_image.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/processor.rb', line 41</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id options'>options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="options=-instance_method"></span>
      <span id="options-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="options-instance_method">
  
    - (<tt>Object</tt>) <strong>options</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute options
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/processor.rb', line 8</span>

<span class='kw'>def</span> <span class='id options'>options</span>
  <span class='ivar'>@options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="geometry_string_valid?-class_method">
  
    + (<tt>Boolean</tt>) <strong>geometry_string_valid?</strong>(string) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The form of an <a
href="http://www.imagemagick.org/script/command-line-options.php?#resize">extended
geometry string</a> is:
</p>
<pre class="code">
  &lt;width&gt;x&lt;height&gt;{+-}&lt;xoffset&gt;{+-}&lt;yoffset&gt;{%}{!}{&lt;}{&gt;}</pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/processor.rb', line 15</span>

<span class='kw'>def</span> <span class='id geometry_string_valid?'>geometry_string_valid?</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span>
  <span class='id string'>string</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>||</span> <span class='id string'>string</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A[\d]*x[\d]*([+-][0-9][+-][0-9])?[%@!&lt;&gt;^]?\z</span><span class='regexp_end'>/</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="valid?-class_method">
  
    + (<tt>Boolean</tt>) <strong>valid?</strong>(arg) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Arg should be either a file or a path. This runs ImageMagick&#8217;s
&#8220;identify&#8221; command and looks for an exit status indicating an
error. If there is no error, then ImageMagick has identified the file as
something it can work with and it will be converted to the desired output
format.
</p>
<p>
Note that this is used in place of any mimetype checks. HasImage assumes
that is ImageMagick is able to process the file, then it&#8217;s OK. Since
ImageMagick can be compiled with many different options for supporting
various file types (or not) this is safer and more complete than checking
the mime type.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/processor.rb', line 30</span>

<span class='kw'>def</span> <span class='id valid?'>valid?</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='rparen'>)</span>
  <span class='id arg'>arg</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>if</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:close</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id arg'>arg</span><span class='period'>.</span><span class='id closed?'>closed?</span>
  <span class='id silence_stderr'>silence_stderr</span> <span class='kw'>do</span>
    <span class='backtick'>`</span><span class='tstring_content'>identify </span><span class='embexpr_beg'>#{</span><span class='id arg'>arg</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id path'>path</span> <span class='op'>:</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>`</span></span>
    <span class='gvar'>$?</span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="measure-instance_method">
  
    - (<tt>Object</tt>) <strong>measure</strong>(path, dimension) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Gets the given <tt>dimension</tt> (width/height) from the image file at
<tt>path</tt>.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/processor.rb', line 65</span>

<span class='kw'>def</span> <span class='id measure'>measure</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id dimension'>dimension</span><span class='rparen'>)</span>
  <span class='const'>MiniMagick</span><span class='op'>::</span><span class='const'>Image</span><span class='period'>.</span><span class='id from_file'>from_file</span><span class='lparen'>(</span><span class='id path'>path</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='id dimension'>dimension</span><span class='period'>.</span><span class='id to_sym'>to_sym</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process-instance_method">
  
    - (<tt>Object</tt>) <strong>process</strong>(file, size = options[:resize_to], format = options[:convert_to]) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='resize-instance_method'>resize</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Creates the resized image, and transforms it to the desired output format
if necessary.
</p>
<p>
<tt>size</tt> should be a valid ImageMagick <a
href="http://www.imagemagick.org/script/command-line-options.php#resize">geometry
string</a>. <tt>format</tt> should be an image format supported by
ImageMagick, e.g. &#8220;PNG&#8221;, &#8220;JPEG&#8221; If a block is
given, it yields the processed image file as a file-like object using
IO#read.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/processor.rb', line 51</span>

<span class='kw'>def</span> <span class='id process'>process</span><span class='lparen'>(</span><span class='id file'>file</span><span class='comma'>,</span> <span class='id size'>size</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:resize_to</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id format'>format</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:convert_to</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='const'>Processor</span><span class='period'>.</span><span class='id geometry_string_valid?'>geometry_string_valid?</span><span class='lparen'>(</span><span class='id size'>size</span><span class='rparen'>)</span>
    <span class='id raise'>raise</span> <span class='const'>InvalidGeometryError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;%s&quot; is not a valid ImageMagick geometry string</span><span class='tstring_end'>'</span></span> <span class='op'>%</span> <span class='id size'>size</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id with_image'>with_image</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id image'>image</span><span class='op'>|</span>
    <span class='id convert_image'>convert_image</span><span class='lparen'>(</span><span class='id image'>image</span><span class='comma'>,</span> <span class='id format'>format</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id format'>format</span>
    <span class='id resize_image'>resize_image</span><span class='lparen'>(</span><span class='id image'>image</span><span class='comma'>,</span> <span class='id size'>size</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id size'>size</span>
    <span class='kw'>yield</span> <span class='const'>IO</span><span class='period'>.</span><span class='id read'>read</span><span class='lparen'>(</span><span class='id image'>image</span><span class='period'>.</span><span class='id path'>path</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
    <span class='id image'>image</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Sep 29 15:48:01 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>