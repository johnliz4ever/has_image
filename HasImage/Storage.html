<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: HasImage::Storage</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../HasImage.html" title="HasImage (module)">HasImage</a></span></span>
     &raquo; 
    <span class="title">Storage</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: HasImage::Storage
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">HasImage::Storage</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/has_image/storage.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Filesystem storage for the HasImage gem. The methods that HasImage inserts
into ActiveRecord models only depend on the public methods in this class,
so it should be reasonably straightforward to implement a different storage
mechanism for Amazon AWS, Photobucket, DBFile, SFTP, or whatever you want.
</p>


  </div>
</div>
<div class="tags">
  
</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#image_data-instance_method" title="#image_data (instance method)">- (Object) <strong>image_data</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute image_data.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">- (Object) <strong>options</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute options.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#temp_file-instance_method" title="#temp_file (instance method)">- (Object) <strong>temp_file</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute temp_file.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generated_file_name-class_method" title="generated_file_name (class method)">+ (Object) <strong>generated_file_name</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
By default, simply accepts and returns the id of the object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#id_from_partitioned_path-class_method" title="id_from_partitioned_path (class method)">+ (Object) <strong>id_from_partitioned_path</strong>(partitioned_path) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#id_from_path-class_method" title="id_from_path (class method)">+ (Object) <strong>id_from_path</strong>(path) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#partitioned_path-class_method" title="partitioned_path (class method)">+ (Object) <strong>partitioned_path</strong>(id, *args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
<a href="http://www.37signals.com/svn/archives2/id_partitioning.php">Jamis
Buck's well known solution</a> to this problem fails with high ids, such as
those created by db:fixture:load.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#escape_file_name_for_http-instance_method" title="#escape_file_name_for_http (instance method)">- (Object) <strong>escape_file_name_for_http</strong>(webpath) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filesystem_path_for-instance_method" title="#filesystem_path_for (instance method)">- (Object) <strong>filesystem_path_for</strong>(object, thumbnail = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Gets the full local filesystem path for an image.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_thumbnail-instance_method" title="#generate_thumbnail (instance method)">- (Object) <strong>generate_thumbnail</strong>(id, name, thumb_name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_thumbnails-instance_method" title="#generate_thumbnails (instance method)">- (Object) <strong>generate_thumbnails</strong>(id, name) </a>
    

    
      (also: #regenerate_thumbnails)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Write the thumbnails to the install directory - probably somewhere under
RAILS_ROOT/public.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#image_too_big%3F-instance_method" title="#image_too_big? (instance method)">- (Boolean) <strong>image_too_big?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Is uploaded file larger than the allowed maximum?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#image_too_small%3F-instance_method" title="#image_too_small? (instance method)">- (Boolean) <strong>image_too_small?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Is uploaded file smaller than the allowed minimum?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Storage) <strong>initialize</strong>(options) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The constuctor should be invoked with the options set by has_image.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#install_images-instance_method" title="#install_images (instance method)">- (Object) <strong>install_images</strong>(object) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Invokes the processor to resize the image(s) and the installs them to the
appropriate directory.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#measure-instance_method" title="#measure (instance method)">- (Object) <strong>measure</strong>(path, dimension) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Measures the given dimension using the processor.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#public_path_for-instance_method" title="#public_path_for (instance method)">- (Object) <strong>public_path_for</strong>(object, thumbnail = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Gets the &#8220;web&#8221; path for an image.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_images-instance_method" title="#remove_images (instance method)">- (Object) <strong>remove_images</strong>(object, name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Deletes the images and directory that contains them.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid%3F-instance_method" title="#valid? (instance method)">- (Boolean) <strong>valid?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Is the uploaded file within the min and max allowed sizes?.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="HasImage::Storage (class)">Storage</a></span></tt>) <strong>initialize</strong>(options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The constuctor should be invoked with the options set by has_image.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 52</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id options'>options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="image_data=-instance_method"></span>
      <span id="image_data-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="image_data-instance_method">
  
    - (<tt>Object</tt>) <strong>image_data</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute image_data
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 17</span>

<span class='kw'>def</span> <span class='id image_data'>image_data</span>
  <span class='ivar'>@image_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="options=-instance_method"></span>
      <span id="options-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="options-instance_method">
  
    - (<tt>Object</tt>) <strong>options</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute options
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 17</span>

<span class='kw'>def</span> <span class='id options'>options</span>
  <span class='ivar'>@options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="temp_file=-instance_method"></span>
      <span id="temp_file-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="temp_file-instance_method">
  
    - (<tt>Object</tt>) <strong>temp_file</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute temp_file
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 17</span>

<span class='kw'>def</span> <span class='id temp_file'>temp_file</span>
  <span class='ivar'>@temp_file</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="generated_file_name-class_method">
  
    + (<tt>Object</tt>) <strong>generated_file_name</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
By default, simply accepts and returns the id of the object. This is here
to allow you to monkey patch this method, for example, if you wish instead
to generate and return a UUID.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 46</span>

<span class='kw'>def</span> <span class='id generated_file_name'>generated_file_name</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id to_param'>to_param</span><span class='period'>.</span><span class='id to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="id_from_partitioned_path-class_method">
  
    + (<tt>Object</tt>) <strong>id_from_partitioned_path</strong>(partitioned_path) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 33</span>

<span class='kw'>def</span> <span class='id id_from_partitioned_path'>id_from_partitioned_path</span><span class='lparen'>(</span><span class='id partitioned_path'>partitioned_path</span><span class='rparen'>)</span>
  <span class='id partitioned_path'>partitioned_path</span><span class='period'>.</span><span class='id join'>join</span><span class='period'>.</span><span class='id to_i'>to_i</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="id_from_path-class_method">
  
    + (<tt>Object</tt>) <strong>id_from_path</strong>(path) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 37</span>

<span class='kw'>def</span> <span class='id id_from_path'>id_from_path</span><span class='lparen'>(</span><span class='id path'>path</span><span class='rparen'>)</span>
  <span class='id path'>path</span> <span class='op'>=</span> <span class='id path'>path</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id path'>path</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id path_partitions'>path_partitions</span> <span class='op'>=</span> <span class='int'>2</span>
  <span class='id id_from_partitioned_path'>id_from_partitioned_path</span><span class='lparen'>(</span><span class='id path'>path</span><span class='period'>.</span><span class='id first'>first</span><span class='lparen'>(</span><span class='id path_partitions'>path_partitions</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="partitioned_path-class_method">
  
    + (<tt>Object</tt>) <strong>partitioned_path</strong>(id, *args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
<a href="http://www.37signals.com/svn/archives2/id_partitioning.php">Jamis
Buck's well known solution</a> to this problem fails with high ids, such as
those created by db:fixture:load. This version scales to large ids more
gracefully. Thanks to Adrian Mugnolo for the fix. ++ FIXME: collides with
IDs with more than 8 digits &#8212;
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 29</span>

<span class='kw'>def</span> <span class='id partitioned_path'>partitioned_path</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%04d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id id'>id</span><span class='period'>.</span><span class='id to_i'>to_i</span> <span class='op'>/</span> <span class='float'>1e4</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='float'>1e4</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%04d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id id'>id</span><span class='period'>.</span><span class='id to_i'>to_i</span> <span class='op'>%</span> <span class='float'>1e4</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id concat'>concat</span><span class='lparen'>(</span><span class='id args'>args</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="escape_file_name_for_http-instance_method">
  
    - (<tt>Object</tt>) <strong>escape_file_name_for_http</strong>(webpath) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 107</span>

<span class='kw'>def</span> <span class='id escape_file_name_for_http'>escape_file_name_for_http</span><span class='lparen'>(</span><span class='id webpath'>webpath</span><span class='rparen'>)</span>
  <span class='id dir'>dir</span><span class='comma'>,</span> <span class='id file'>file</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='id webpath'>webpath</span><span class='rparen'>)</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='id dir'>dir</span><span class='comma'>,</span> <span class='const'>CGI</span><span class='period'>.</span><span class='id escape'>escape</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="filesystem_path_for-instance_method">
  
    - (<tt>Object</tt>) <strong>filesystem_path_for</strong>(object, thumbnail = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Gets the full local filesystem path for an image. For example:
</p>
<pre class="code">
  /var/sites/example.com/production/public/photos/0000/0001/3er0zs.jpg</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 146</span>

<span class='kw'>def</span> <span class='id filesystem_path_for'>filesystem_path_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id thumbnail'>thumbnail</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='id path_for'>path_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='period'>.</span><span class='id has_image_id'>has_image_id</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id file_name_for'>file_name_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='period'>.</span><span class='id send'>send</span><span class='lparen'>(</span><span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:column</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id thumbnail'>thumbnail</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="generate_thumbnail-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_thumbnail</strong>(id, name, thumb_name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="StorageError.html" title="HasImage::StorageError (class)">StorageError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134
135
136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 132</span>

<span class='kw'>def</span> <span class='id generate_thumbnail'>generate_thumbnail</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id name'>name</span><span class='comma'>,</span> <span class='id thumb_name'>thumb_name</span><span class='rparen'>)</span>
  <span class='id size_spec'>size_spec</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:thumbnails</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id thumb_name'>thumb_name</span><span class='period'>.</span><span class='id to_sym'>to_sym</span><span class='rbracket'>]</span>
  <span class='id raise'>raise</span> <span class='const'>StorageError</span> <span class='kw'>unless</span> <span class='id size_spec'>size_spec</span>
  <span class='id ensure_directory_exists!'>ensure_directory_exists!</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span> <span class='id absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id name'>name</span><span class='comma'>,</span> <span class='id thumb_name'>thumb_name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id thumbnail_destination'>thumbnail_destination</span><span class='op'>|</span>
    <span class='id processor'>processor</span><span class='period'>.</span><span class='id process'>process</span> <span class='id absolute_path'>absolute_path</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id name'>name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id size_spec'>size_spec</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id thumbnail_data'>thumbnail_data</span><span class='op'>|</span>
      <span class='id thumbnail_destination'>thumbnail_destination</span><span class='period'>.</span><span class='id write'>write</span> <span class='id thumbnail_data'>thumbnail_data</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="generate_thumbnails-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_thumbnails</strong>(id, name) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='regenerate_thumbnails-instance_method'>regenerate_thumbnails</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Write the thumbnails to the install directory - probably somewhere under
RAILS_ROOT/public.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 126</span>

<span class='kw'>def</span> <span class='id generate_thumbnails'>generate_thumbnails</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id name'>name</span><span class='rparen'>)</span>
  <span class='id ensure_directory_exists!'>ensure_directory_exists!</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
  <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:thumbnails</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id thumb_name'>thumb_name</span><span class='op'>|</span> <span class='id generate_thumbnail'>generate_thumbnail</span><span class='lparen'>(</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id name'>name</span><span class='comma'>,</span> <span class='id thumb_name'>thumb_name</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="image_too_big?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>image_too_big?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Is uploaded file larger than the allowed maximum?
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 77</span>

<span class='kw'>def</span> <span class='id image_too_big?'>image_too_big?</span>
  <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id open'>open</span> <span class='kw'>if</span> <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id closed?'>closed?</span>
  <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&gt;</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="image_too_small?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>image_too_small?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Is uploaded file smaller than the allowed minimum?
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 71</span>

<span class='kw'>def</span> <span class='id image_too_small?'>image_too_small?</span>
  <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id open'>open</span> <span class='kw'>if</span> <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id closed?'>closed?</span>
  <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&lt;</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="install_images-instance_method">
  
    - (<tt>Object</tt>) <strong>install_images</strong>(object) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Invokes the processor to resize the image(s) and the installs them to the
appropriate directory.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 84</span>

<span class='kw'>def</span> <span class='id install_images'>install_images</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span>
  <span class='id generated_name'>generated_name</span> <span class='op'>=</span> <span class='const'>Storage</span><span class='period'>.</span><span class='id generated_file_name'>generated_file_name</span><span class='lparen'>(</span><span class='id object'>object</span><span class='rparen'>)</span>
  <span class='id install_main_image'>install_main_image</span><span class='lparen'>(</span><span class='id object'>object</span><span class='period'>.</span><span class='id has_image_id'>has_image_id</span><span class='comma'>,</span> <span class='id generated_name'>generated_name</span><span class='rparen'>)</span>
  <span class='id generate_thumbnails'>generate_thumbnails</span><span class='lparen'>(</span><span class='id object'>object</span><span class='period'>.</span><span class='id has_image_id'>has_image_id</span><span class='comma'>,</span> <span class='id generated_name'>generated_name</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id thumbnails_needed?'>thumbnails_needed?</span>
  <span class='kw'>return</span> <span class='id generated_name'>generated_name</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id close!'>close!</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@temp_file</span><span class='period'>.</span><span class='id closed?'>closed?</span>
  <span class='ivar'>@temp_file</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="measure-instance_method">
  
    - (<tt>Object</tt>) <strong>measure</strong>(path, dimension) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Measures the given dimension using the processor
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 95</span>

<span class='kw'>def</span> <span class='id measure'>measure</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id dimension'>dimension</span><span class='rparen'>)</span>
  <span class='id processor'>processor</span><span class='period'>.</span><span class='id measure'>measure</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id dimension'>dimension</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="public_path_for-instance_method">
  
    - (<tt>Object</tt>) <strong>public_path_for</strong>(object, thumbnail = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Gets the &#8220;web&#8221; path for an image. For example:
</p>
<pre class="code">
  /photos/0000/0001/3er0zs.jpg</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 102</span>

<span class='kw'>def</span> <span class='id public_path_for'>public_path_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id thumbnail'>thumbnail</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id webpath'>webpath</span> <span class='op'>=</span> <span class='id filesystem_path_for'>filesystem_path_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id thumbnail'>thumbnail</span><span class='rparen'>)</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A.*public</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id escape_file_name_for_http'>escape_file_name_for_http</span><span class='lparen'>(</span><span class='id webpath'>webpath</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remove_images-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_images</strong>(object, name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Deletes the images and directory that contains them.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 113</span>

<span class='kw'>def</span> <span class='id remove_images'>remove_images</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id name'>name</span><span class='rparen'>)</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm'>rm</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id glob'>glob</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='id path_for'>path_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='period'>.</span><span class='id has_image_id'>has_image_id</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id name'>name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>Dir</span><span class='period'>.</span><span class='id rmdir'>rmdir</span> <span class='id path_for'>path_for</span><span class='lparen'>(</span><span class='id object'>object</span><span class='period'>.</span><span class='id has_image_id'>has_image_id</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>SystemCallError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="valid?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>valid?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Is the uploaded file within the min and max allowed sizes?
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/has_image/storage.rb', line 120</span>

<span class='kw'>def</span> <span class='id valid?'>valid?</span>
  <span class='op'>!</span><span class='lparen'>(</span><span class='id image_too_small?'>image_too_small?</span> <span class='op'>||</span> <span class='id image_too_big?'>image_too_big?</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Sep 29 15:48:01 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>